on: push
name: AzureCLISample

#  az ad sp create-for-rbac \
#    --name "http://hello" --role contributor \
#    --scopes /subscriptions/5465f0aa-77ae-4324-bcf4-1cd1aa584f44/resourceGroups/stcu-demo-rg \
#    --sdk-auth
#
# New-AzApiManagement -ResourceGroupName stcu-demo-rg -Name stcu-hello-apim -Location 'West US' -Sku Consumption -Organization STCU -AdminEmail contoso@contoso.com -AssignIdentity


jobs:
    build-and-deploy:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@master

            - name: Installing PS module
              shell: pwsh
              run: |
                    Set-PSRepository -Name PSGallery -InstallationPolicy Trusted
                    Install-Module Az.ApiManagement

            - name: Azure Login
              uses: azure/login@v1
              with:
                  creds: ${{ secrets.AZURE_CREDENTIALS }}

            - name: Create APIM
              shell: pwsh
              run: |
                  New-AzApiManagement -ResourceGroupName stcu-demo-rg -Name stcu-hello-apim -Location 'West US' -Sku Consumption -Organization STCU -AdminEmail contoso@contoso.com -AssignIdentity

              #echo ${env:PATH}
    
      # - name: Azure Login
      #   uses: azure/login@v1
      #   with:
      #     creds: ${{ secrets.AZURE_CREDENTIALS }}

      # - name: Azure CLI script
      #   uses: azure/CLI@v1
      #   with:
      #     azcliversion: latest
      #     inlineScript: |
      #       az apim create \
      #         --name stcu-apim-hello -g stcu-demo-rg -l westus \
      #         --publisher-email christopher.lopes@gmail.com --publisher-name Personal
